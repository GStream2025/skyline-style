{% extends "admin/base_admin.html" %}
{% block title %}Admin · Ofertas{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto px-4 py-6">
  <div class="flex items-center justify-between gap-4 flex-wrap">
    <div>
      <h1 class="text-2xl font-semibold">Ofertas / Promos</h1>
      <p class="text-slate-500 text-sm">Creá banners/cards para la home y secciones.</p>
    </div>
  </div>

  <div class="mt-6 grid grid-cols-1 lg:grid-cols-3 gap-6">
    <form class="rounded-2xl border border-slate-200 bg-white p-4 shadow-sm" method="post" action="{{ url_for('admin.offers_new') }}" enctype="multipart/form-data">
      <h2 class="font-semibold">Nueva oferta</h2>
      <div class="mt-3 space-y-3">
        <div>
          <label class="text-xs text-slate-500">Título</label>
          <input name="title" class="w-full mt-1 rounded-xl border border-slate-200 px-3 py-2" placeholder="Ej: 2x1 Streetwear" required>
        </div>
        <div>
          <label class="text-xs text-slate-500">Subtítulo</label>
          <input name="subtitle" class="w-full mt-1 rounded-xl border border-slate-200 px-3 py-2" placeholder="Ej: Solo esta semana">
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="text-xs text-slate-500">Badge</label>
            <input name="badge" class="w-full mt-1 rounded-xl border border-slate-200 px-3 py-2" placeholder="NEW / HOT">
          </div>
          <div>
            <label class="text-xs text-slate-500">Orden</label>
            <input name="sort_order" type="number" class="w-full mt-1 rounded-xl border border-slate-200 px-3 py-2" value="0">
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="text-xs text-slate-500">CTA Texto</label>
            <input name="cta_text" class="w-full mt-1 rounded-xl border border-slate-200 px-3 py-2" placeholder="Comprar">
          </div>
          <div>
            <label class="text-xs text-slate-500">CTA URL</label>
            <input name="cta_url" class="w-full mt-1 rounded-xl border border-slate-200 px-3 py-2" placeholder="/shop">
          </div>
        </div>
        <div>
          <label class="text-xs text-slate-500">Media (img/video)</label>
          <input name="media" type="file" class="w-full mt-1 rounded-xl border border-slate-200 px-3 py-2">
        </div>
        <label class="inline-flex items-center gap-2 text-sm">
          <input type="checkbox" name="active" checked class="rounded border-slate-300">
          Activa
        </label>

        <button class="w-full rounded-xl bg-slate-900 text-white py-2 font-medium hover:opacity-95">Crear oferta</button>
      </div>
    </form>

    <div class="lg:col-span-2">
      <div class="rounded-2xl border border-slate-200 bg-white shadow-sm overflow-hidden">
        <div class="px-4 py-3 border-b border-slate-200 flex items-center justify-between">
          <h2 class="font-semibold">Ofertas existentes ({{ offers|length }})</h2>
        </div>

        <div class="divide-y divide-slate-100">
          {% for o in offers %}
          <div class="p-4 flex gap-4 items-start">
            <div class="w-24 h-24 rounded-xl bg-slate-50 border border-slate-200 overflow-hidden flex items-center justify-center">
              {% if o.media_url %}
                {% if o.media_url.endswith('.mp4') or o.media_url.endswith('.webm') %}
                  <video src="{{ o.media_url }}" class="w-full h-full object-cover" muted playsinline></video>
                {% else %}
                  <img src="{{ o.media_url }}" class="w-full h-full object-cover" alt="">
                {% endif %}
              {% else %}
                <span class="text-xs text-slate-400">sin media</span>
              {% endif %}
            </div>
            <div class="flex-1">
              <div class="flex items-center gap-2">
                <span class="font-semibold">{{ o.title }}</span>
                {% if o.active %}
                  <span class="text-xs px-2 py-0.5 rounded-full bg-emerald-100 text-emerald-700">Activa</span>
                {% else %}
                  <span class="text-xs px-2 py-0.5 rounded-full bg-slate-100 text-slate-600">Inactiva</span>
                {% endif %}
                {% if o.badge %}
                  <span class="text-xs px-2 py-0.5 rounded-full bg-amber-100 text-amber-700">{{ o.badge }}</span>
                {% endif %}
              </div>
              {% if o.subtitle %}
                <p class="text-sm text-slate-500 mt-1">{{ o.subtitle }}</p>
              {% endif %}
              <div class="text-xs text-slate-400 mt-2">
                Orden: {{ o.sort_order }} · CTA: {{ o.cta_text or '-' }} → {{ o.cta_url or '-' }}
              </div>
            </div>
            <form method="post" action="{{ url_for('admin.offers_delete', offer_id=o.id) }}" onsubmit="return confirm('Eliminar oferta?')">
              <button class="rounded-xl border border-rose-200 text-rose-600 px-3 py-2 text-sm hover:bg-rose-50">Eliminar</button>
            </form>
          </div>
          {% else %}
            <div class="p-6 text-slate-500">Todavía no hay ofertas.</div>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
