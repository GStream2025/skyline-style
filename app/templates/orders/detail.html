{% extends "base.html" %}
{% block title %}Pedido {{ order.number or order.id }} · Skyline Store{% endblock %}

{% set STATUS_FLOW = [
  ("created","Pedido creado"),
  ("paid","Pago confirmado"),
  ("processing","Preparando"),
  ("shipped","Enviado"),
  ("delivered","Entregado")
] %}

{% block content %}
<section class="max-w-5xl mx-auto px-4 py-14">

  <h1 class="text-2xl font-bold text-slate-900">
    Pedido {{ order.number or order.id }}
  </h1>
  <p class="text-slate-600 mt-1">
    Estado actual:
    <b class="text-emerald-600">{{ order.status|capitalize }}</b>
  </p>

  <!-- TIMELINE -->
  <div class="mt-8 bg-white border rounded-2xl p-6 shadow">
    <h2 class="font-semibold mb-4">Seguimiento del pedido</h2>

    <ol class="relative border-l border-slate-200">
      {% for code,label in STATUS_FLOW %}
        {% set active = STATUS_FLOW.index((code,label)) <= STATUS_FLOW.index((order.status, label)) if order.status in STATUS_FLOW|map(attribute=0) else false %}
        <li class="ml-6 mb-6">
          <span class="absolute -left-3 flex h-6 w-6 items-center justify-center rounded-full
            {{ 'bg-emerald-500 text-white' if active else 'bg-slate-200 text-slate-500' }}">
            ✓
          </span>
          <h3 class="font-medium text-slate-900">{{ label }}</h3>
        </li>
      {% endfor %}
    </ol>
  </div>

  <!-- ITEMS -->
  <div class="mt-8 bg-white border rounded-2xl p-6 shadow">
    <h2 class="font-semibold mb-4">Productos</h2>

    {% for it in order.items %}
    <div class="flex justify-between border-b py-3">
      <div>
        <div class="font-medium">{{ it.title }}</div>
        <div class="text-sm text-slate-500">Cantidad: {{ it.qty }}</div>
      </div>
      <div class="font-semibold">
        $ {{ "%.2f"|format(it.qty * it.price) }}
      </div>
    </div>
    {% endfor %}

    <div class="flex justify-between pt-4 text-lg font-bold">
      <span>Total</span>
      <span>$ {{ "%.2f"|format(order.total) }}</span>
    </div>
  </div>

</section>
{% endblock %}
