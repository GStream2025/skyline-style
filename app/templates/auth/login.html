{% extends "base.html" %}
{% block title %}Ingresar | Skyline Store{% endblock %}

{% block extra_head %}
<style>
/* =========================
 LOGIN ‚Äî Marketplace Premium
========================= */
.auth-wrap{
  min-height: calc(100vh - 180px);
  display:grid;
  place-items:center;
  padding: 24px 18px;
}

.auth-card{
  width:100%;
  max-width: 920px;
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap:18px;
}

@media (max-width: 900px){
  .auth-card{grid-template-columns: 1fr}
}

.auth-left{
  background:
    radial-gradient(420px 260px at 20% 10%, rgba(47,123,255,.18), transparent 60%),
    radial-gradient(420px 260px at 90% 20%, rgba(255,181,71,.20), transparent 60%),
    linear-gradient(180deg, rgba(255,255,255,.96), rgba(255,255,255,.86));
  border:1px solid var(--stroke);
  border-radius: 22px;
  padding: 26px;
  box-shadow: var(--shadow2);
}

.auth-brand{display:flex; align-items:center; gap:12px;}
.auth-mark{
  width:38px;height:28px;
  border-radius:12px;
  background: var(--grad);
  box-shadow: 0 12px 22px rgba(2,6,23,.16);
}
.auth-title{font-weight: 950; letter-spacing:-.4px;}
.auth-sub{font-weight:700; color: rgba(11,18,32,.62); font-size:.92rem;}

.auth-left h1{
  margin: 16px 0 0;
  font-weight: 950;
  letter-spacing:-.6px;
  font-size: clamp(1.8rem, 4vw, 2.4rem);
  color: rgba(11,18,32,.95);
}
.auth-left p{
  margin-top:10px;
  max-width: 46ch;
  color: rgba(11,18,32,.62);
  font-weight: 650;
}

.auth-benefits{
  margin-top:16px;
  display:grid;
  gap:10px;
}
.benefit{
  display:flex; gap:12px; align-items:flex-start;
  padding:12px;
  border-radius:16px;
  background: rgba(255,255,255,.80);
  border:1px solid var(--stroke);
}
.benefit .dot{
  width:12px;height:12px;border-radius:99px;
  background: var(--grad);
  margin-top:6px;
}
.benefit b{display:block; font-weight:900;}
.benefit span{display:block; font-weight:650; color: rgba(11,18,32,.60); font-size:.92rem;}

/* ===== Right / Form ===== */
.auth-right{
  background:#fff;
  border:1px solid var(--stroke);
  border-radius: 22px;
  padding: 26px;
  box-shadow: var(--shadow2);
}

.auth-head{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
}
.auth-head h2{margin:0; font-weight: 950; letter-spacing:-.4px;}
.secure{
  display:inline-flex; align-items:center; gap:8px;
  padding: 8px 10px;
  border-radius:999px;
  background: rgba(47,123,255,.10);
  border:1px solid rgba(47,123,255,.20);
  font-weight:800;
  font-size:.82rem;
}

.flash{
  margin-top:12px;
  padding:10px 12px;
  border-radius:14px;
  border:1px solid var(--stroke);
  font-weight:850;
  font-size:.92rem;
  background: rgba(2,6,23,.03);
}
.flash.error{background: rgba(255,0,0,.06); border-color: rgba(255,0,0,.14);}
.flash.warning{background: rgba(255,181,71,.10); border-color: rgba(255,181,71,.18);}
.flash.success{background: rgba(34,197,94,.10); border-color: rgba(34,197,94,.18);}
.flash.info{background: rgba(47,123,255,.08); border-color: rgba(47,123,255,.16);}

.form{margin-top:16px; display:grid; gap:14px;}

.field label{
  display:block;
  font-size:.8rem;
  font-weight:800;
  color: rgba(11,18,32,.62);
  margin-bottom:6px;
}

.field input{
  width:100%;
  padding: 14px 14px;
  border-radius: 14px;
  border:1px solid var(--stroke);
  font-weight:700;
  font-size:.95rem;
}

.field input:focus{
  outline:none;
  border-color: rgba(47,123,255,.35);
  box-shadow: 0 0 0 4px rgba(47,123,255,.14);
}

.pass-wrap{position:relative}
.pass-toggle{
  position:absolute;
  right:10px;
  top:50%;
  transform:translateY(-50%);
  border:0;
  background: rgba(255,255,255,.85);
  border-radius:10px;
  padding:6px 10px;
  cursor:pointer;
  font-weight:900;
}

.submit{
  margin-top:6px;
  width:100%;
  padding: 14px;
  border-radius: 16px;
  background: var(--grad);
  color:#fff;
  border:0;
  font-weight:950;
  cursor:pointer;
  box-shadow: 0 16px 30px rgba(2,6,23,.16);
}
.submit:active{transform:translateY(1px)}
.submit[disabled]{opacity:.85; cursor:not-allowed}

.auth-links{
  margin-top:10px;
  display:flex;
  justify-content:space-between;
  font-size:.9rem;
  font-weight:800;
  gap:10px;
  flex-wrap:wrap;
}
.auth-links a{text-decoration:none}
</style>
{% endblock %}

{% block content %}
<section class="auth-wrap">
  <div class="auth-card">

    <!-- LEFT -->
    <div class="auth-left">
      <div class="auth-brand">
        <span class="auth-mark"></span>
        <div>
          <div class="auth-title">Skyline Store</div>
          <div class="auth-sub">Marketplace premium</div>
        </div>
      </div>

      <h1>Bienvenido de vuelta</h1>
      <p>
        Ingres√° para continuar con tu compra, ver pedidos
        y acceder a beneficios exclusivos.
      </p>

      <div class="auth-benefits">
        <div class="benefit">
          <span class="dot"></span>
          <div><b>Acceso r√°pido</b><span>Entr√° y segu√≠ comprando.</span></div>
        </div>
        <div class="benefit">
          <span class="dot"></span>
          <div><b>Historial</b><span>Pedidos y seguimiento en un lugar.</span></div>
        </div>
      </div>
    </div>

    <!-- RIGHT -->
    <div class="auth-right">
      <div class="auth-head">
        <h2>Ingresar</h2>
        <span class="secure">üîí Seguro</span>
      </div>

      {# FLASH MESSAGES #}
      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          {% for category, msg in messages %}
            <div class="flash {{ category|e }}">{{ msg }}</div>
          {% endfor %}
        {% endif %}
      {% endwith %}

      <form method="post" action="{{ url_for('auth.login') }}" class="form" id="loginForm" novalidate>
        {# CSRF token (CR√çTICO) #}
        <input type="hidden" name="csrf_token" value="{{ csrf_token }}">

        {% if next %}<input type="hidden" name="next" value="{{ next }}">{% endif %}

        <div class="field">
          <label for="email">Correo electr√≥nico</label>
          <input id="email" type="email" name="email" required autocomplete="email"
                 value="{{ request.form.get('email','') if request.method=='POST' else '' }}"
                 placeholder="tu@email.com">
        </div>

        <div class="field">
          <label for="password">Contrase√±a</label>
          <div class="pass-wrap">
            <input id="password" type="password" name="password" required autocomplete="current-password"
                   placeholder="Tu contrase√±a">
            <button type="button" class="pass-toggle" id="togglePass" aria-label="Mostrar contrase√±a">üëÅ</button>
          </div>
        </div>

        <button type="submit" class="submit" id="submitBtn">Entrar</button>

        <div class="auth-links">
          <a href="{{ url_for('auth.register') }}">Crear cuenta</a>

          {# si m√°s adelante agreg√°s reset, esto no rompe #}
          {% if 'auth.forgot' in current_app.view_functions %}
            <a href="{{ url_for('auth.forgot') }}">Olvid√© mi contrase√±a</a>
          {% else %}
            <a href="{{ url_for('shop.shop') }}">Seguir como invitado</a>
          {% endif %}
        </div>

        {% if 'auth.forgot' not in current_app.view_functions %}
          <div class="auth-links" style="margin-top:0">
            <a href="{{ url_for('shop.shop') }}">Seguir como invitado</a>
          </div>
        {% endif %}
      </form>
    </div>

  </div>
</section>

<script>
(function(){
  const pass = document.getElementById("password");
  const toggle = document.getElementById("togglePass");
  const form = document.getElementById("loginForm");
  const btn = document.getElementById("submitBtn");

  if(toggle && pass){
    toggle.addEventListener("click", () => {
      pass.type = pass.type === "password" ? "text" : "password";
    });
  }

  // anti doble submit
  if(form && btn){
    form.addEventListener("submit", () => {
      btn.disabled = true;
      btn.textContent = "Entrando‚Ä¶";
    });
  }
})();
</script>
{% endblock %}
