{% extends "base.html" %}
{% block title %}Crear cuenta | Skyline Store{% endblock %}

{% block extra_head %}
<style>
/* =========================
 AUTH ‚Äî Marketplace Premium
========================= */
.auth-wrap{
  min-height: calc(100vh - 180px);
  display:grid;
  place-items:center;
  padding: 24px 18px;
}
.auth-card{
  width:100%;
  max-width: 980px;
  display:grid;
  grid-template-columns: 1.1fr .9fr;
  gap:18px;
}
@media (max-width: 900px){
  .auth-card{grid-template-columns: 1fr}
}
.auth-left{
  background:
    radial-gradient(420px 260px at 20% 10%, rgba(47,123,255,.18), transparent 60%),
    radial-gradient(420px 260px at 90% 20%, rgba(255,181,71,.20), transparent 60%),
    linear-gradient(180deg, rgba(255,255,255,.96), rgba(255,255,255,.86));
  border:1px solid var(--stroke);
  border-radius: 22px;
  padding: 26px;
  box-shadow: var(--shadow2);
}
.auth-brand{display:flex; align-items:center; gap:12px;}
.auth-mark{
  width:38px;height:28px;border-radius:12px;
  background: var(--grad);
  box-shadow: 0 12px 22px rgba(2,6,23,.16);
}
.auth-title{font-weight: 950; letter-spacing:-.4px;}
.auth-sub{font-weight:700; color: rgba(11,18,32,.62); font-size:.92rem;}
.auth-left h1{
  margin: 16px 0 0;
  font-weight: 950;
  letter-spacing:-.6px;
  font-size: clamp(1.8rem, 4vw, 2.4rem);
  color: rgba(11,18,32,.95);
}
.auth-left p{
  margin-top:10px;
  max-width: 46ch;
  color: rgba(11,18,32,.62);
  font-weight: 650;
}
.auth-benefits{margin-top:16px; display:grid; gap:10px;}
.benefit{
  display:flex; gap:12px; align-items:flex-start;
  padding:12px;
  border-radius:16px;
  background: rgba(255,255,255,.80);
  border:1px solid var(--stroke);
}
.benefit .dot{
  width:12px;height:12px;border-radius:99px;
  background: var(--grad);
  margin-top:6px;
}
.benefit b{display:block; font-weight:900;}
.benefit span{display:block; font-weight:650; color: rgba(11,18,32,.60); font-size:.92rem;}

/* ===== Right / Form ===== */
.auth-right{
  background:#fff;
  border:1px solid var(--stroke);
  border-radius: 22px;
  padding: 26px;
  box-shadow: var(--shadow2);
}
.auth-head{
  display:flex; align-items:center; justify-content:space-between; gap:12px;
}
.auth-head h2{margin:0; font-weight: 950; letter-spacing:-.4px;}
.secure{
  display:inline-flex; align-items:center; gap:8px;
  padding: 8px 10px;
  border-radius:999px;
  background: rgba(47,123,255,.10);
  border:1px solid rgba(47,123,255,.20);
  font-weight:800;
  font-size:.82rem;
}

.flash{
  margin-top:12px;
  padding:10px 12px;
  border-radius:14px;
  border:1px solid var(--stroke);
  font-weight:800;
  font-size:.92rem;
  background: rgba(2,6,23,.03);
}
.flash.error{background: rgba(255,0,0,.06); border-color: rgba(255,0,0,.14);}
.flash.warning{background: rgba(255,181,71,.10); border-color: rgba(255,181,71,.18);}
.flash.success{background: rgba(34,197,94,.10); border-color: rgba(34,197,94,.18);}
.flash.info{background: rgba(47,123,255,.08); border-color: rgba(47,123,255,.16);}

.form{margin-top:16px; display:grid; gap:14px;}
.field label{
  display:block; font-size:.8rem; font-weight:800;
  color: rgba(11,18,32,.62); margin-bottom:6px;
}
.field input{
  width:100%;
  padding: 14px 14px;
  border-radius: 14px;
  border:1px solid var(--stroke);
  font-weight:700;
  font-size:.95rem;
}
.field input:focus{
  outline:none;
  border-color: rgba(47,123,255,.35);
  box-shadow: 0 0 0 4px rgba(47,123,255,.14);
}
.pass-wrap{position:relative}
.pass-toggle{
  position:absolute; right:10px; top:50%;
  transform:translateY(-50%);
  border:0;
  background: rgba(255,255,255,.85);
  border-radius:10px;
  padding:6px 10px;
  cursor:pointer;
  font-weight:900;
}
.meter{
  height:6px; border-radius:999px;
  background: #eef2ff; overflow:hidden;
  border:1px solid var(--stroke);
}
.meter > span{
  display:block; height:100%;
  width:0%;
  background: var(--grad);
  transition: width .2s var(--ease);
}
.rules{
  display:grid; gap:4px;
  font-size:.78rem;
  color: rgba(11,18,32,.58);
}
.submit{
  margin-top:6px;
  width:100%;
  padding: 14px;
  border-radius: 16px;
  background: var(--grad);
  color:#fff;
  border:0;
  font-weight:950;
  cursor:pointer;
  box-shadow: 0 16px 30px rgba(2,6,23,.16);
}
.submit:active{transform:translateY(1px)}
.auth-links{
  margin-top:10px;
  display:flex;
  justify-content:space-between;
  font-size:.9rem;
  font-weight:800;
}
.auth-links a{text-decoration:none}
</style>
{% endblock %}

{% block content %}
<section class="auth-wrap">
  <div class="auth-card">

    <!-- LEFT -->
    <div class="auth-left">
      <div class="auth-brand">
        <span class="auth-mark"></span>
        <div>
          <div class="auth-title">Skyline Store</div>
          <div class="auth-sub">Marketplace premium</div>
        </div>
      </div>

      <h1>Cre√° tu cuenta</h1>
      <p>
        Compr√° m√°s r√°pido, guard√° pedidos y acced√© a ofertas exclusivas
        en un solo lugar.
      </p>

      <div class="auth-benefits">
        <div class="benefit">
          <span class="dot"></span>
          <div><b>Checkout r√°pido</b><span>Menos pasos, m√°s velocidad.</span></div>
        </div>
        <div class="benefit">
          <span class="dot"></span>
          <div><b>Seguimiento</b><span>Control total de tus compras.</span></div>
        </div>
        <div class="benefit">
          <span class="dot"></span>
          <div><b>Ofertas exclusivas</b><span>Promos solo para usuarios.</span></div>
        </div>
      </div>
    </div>

    <!-- RIGHT -->
    <div class="auth-right">
      <div class="auth-head">
        <h2>Crear cuenta</h2>
        <span class="secure">üîí Seguro</span>
      </div>

      {# FLASH MESSAGES #}
      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          {% for category, message in messages %}
            <div class="flash {{ category|e }}">{{ message }}</div>
          {% endfor %}
        {% endif %}
      {% endwith %}

      <form method="post" action="{{ url_for('auth.register') }}" class="form" id="registerForm">
        {# CSRF token (CR√çTICO) #}
        <input type="hidden" name="csrf_token" value="{{ csrf_token }}">

        {% if next %}<input type="hidden" name="next" value="{{ next }}">{% endif %}

        <div class="field">
          <label>Nombre (opcional)</label>
          <input type="text" name="name" maxlength="120"
                 value="{{ request.form.get('name','') if request.method=='POST' else '' }}"
                 placeholder="Tu nombre">
        </div>

        <div class="field">
          <label>Correo electr√≥nico</label>
          <input type="email" name="email" required autocomplete="email"
                 value="{{ request.form.get('email','') if request.method=='POST' else '' }}"
                 placeholder="tu@email.com">
        </div>

        <div class="field">
          <label>Contrase√±a</label>
          <div class="pass-wrap">
            <input type="password" name="password" id="password" required minlength="8"
                   autocomplete="new-password"
                   placeholder="M√≠nimo 8 caracteres">
            <button type="button" class="pass-toggle" id="togglePass" aria-label="Mostrar contrase√±a">üëÅ</button>
          </div>
          <div class="meter"><span id="meter"></span></div>
          <div class="rules">
            <span>‚Ä¢ 8+ caracteres</span>
            <span>‚Ä¢ Letras y n√∫meros</span>
            <span>‚Ä¢ 1 may√∫scula (recomendado)</span>
          </div>
        </div>

        <button type="submit" class="submit">Crear cuenta</button>

        <div class="auth-links">
          <a href="{{ url_for('auth.login') }}">Ya tengo cuenta</a>
          <a href="{{ url_for('shop.shop') }}">Seguir como invitado</a>
        </div>
      </form>
    </div>

  </div>
</section>

<script>
(function(){
  const pass = document.getElementById("password");
  const meter = document.getElementById("meter");
  const toggle = document.getElementById("togglePass");
  const form = document.getElementById("registerForm");

  function score(v){
    let s = 0;
    if(v.length >= 8) s += 40;
    if(/[0-9]/.test(v) && /[a-zA-Z]/.test(v)) s += 35;
    if(/[A-Z]/.test(v)) s += 25;
    return Math.min(100, s);
  }

  if(pass){
    pass.addEventListener("input", () => {
      meter.style.width = score(pass.value) + "%";
    });
  }

  if(toggle && pass){
    toggle.addEventListener("click", () => {
      pass.type = pass.type === "password" ? "text" : "password";
    });
  }

  // evita doble submit accidental
  if(form){
    form.addEventListener("submit", () => {
      const btn = form.querySelector("button[type='submit']");
      if(btn){
        btn.disabled = true;
        btn.style.opacity = "0.85";
        btn.textContent = "Creando...";
      }
    });
  }
})();
</script>
{% endblock %}
