{% extends "base.html" %}
{% block title %}Crear cuenta | Skyline Store{% endblock %}

{% block extra_head %}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/register.css') }}">
{% endblock %}

{% block content %}
<section class="ss-reg" aria-label="Crear cuenta">
  <div class="ss-reg__shell">

    <!-- LEFT -->
    <aside class="ss-reg__card ss-reg__left" aria-label="Beneficios">
      <div class="ss-reg__brand">
        <div class="ss-reg__logo" aria-hidden="true"></div>
        <div>
          <b>Skyline Store</b>
          <span>Marketplace profesional</span>
        </div>
      </div>

      <h1>Cre√° tu cuenta</h1>
      <p>
        Acced√© a una plataforma profesional para comprar, gestionar pedidos
        y participar de nuestro programa oficial de afiliados.
      </p>

      <div class="ss-reg__trust" aria-label="Seguridad">
        <span>‚úî Cuenta protegida</span>
        <span>‚úî Verificaci√≥n por email</span>
        <span>‚úî Datos cifrados</span>
        <span>‚úî Soporte real</span>
      </div>
    </aside>

    <!-- RIGHT -->
    <div class="ss-reg__card ss-reg__right" aria-label="Formulario de registro">
      <div class="ss-reg__steps" aria-label="Progreso">
        <div class="ss-reg__step is-active">Cuenta</div>
        <div class="ss-reg__step">Verificaci√≥n</div>
        <div class="ss-reg__step">Listo</div>
      </div>

      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          {% for c,m in messages %}
            <div class="ss-reg__flash {{ c|e }}" role="alert" aria-live="polite" aria-atomic="true">{{ m }}</div>
          {% endfor %}
        {% endif %}
      {% endwith %}

      <form method="post"
            action="{{ url_for('auth.register') }}"
            class="ss-reg__form"
            id="registerForm"
            novalidate>

        {% if csrf_token is defined %}
          {% if csrf_token is callable %}
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
          {% else %}
            <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
          {% endif %}
        {% endif %}

        {# NONCE obligatorio para tu backend #}
        <input type="hidden" name="nonce" value="{{ nonce|default('') }}">

        {# next seguro #}
        {% set nxt = next|default(request.args.get('next','')) %}
        {% if nxt %}<input type="hidden" name="next" value="{{ nxt|e }}">{% endif %}

        <div class="ss-reg__grid2">
          <div class="ss-reg__field">
            <label for="name">
              <span>Nombre</span>
              <span class="ss-reg__hint">Opcional</span>
            </label>
            <input class="ss-reg__input"
                   id="name"
                   type="text"
                   name="name"
                   maxlength="120"
                   autocomplete="name"
                   value="{{ request.form.get('name','') if request.method=='POST' else '' }}"
                   placeholder="Nombre (opcional)">
          </div>

          <div class="ss-reg__field">
            <label for="email">
              <span>Email</span>
              <span class="ss-reg__hint">Requerido</span>
            </label>
            <input class="ss-reg__input"
                   id="email"
                   type="email"
                   name="email"
                   required
                   maxlength="254"
                   autocomplete="email"
                   inputmode="email"
                   autocapitalize="none"
                   spellcheck="false"
                   value="{{ request.form.get('email','') if request.method=='POST' else '' }}"
                   placeholder="Correo electr√≥nico">
          </div>
        </div>

        <div class="ss-reg__grid2">
          <div class="ss-reg__field">
            <label for="password">
              <span>Contrase√±a</span>
              <span class="ss-reg__hint">8+ caracteres</span>
            </label>

            <div class="ss-reg__pass-wrap">
              <input class="ss-reg__input"
                     id="password"
                     type="password"
                     name="password"
                     required
                     minlength="8"
                     maxlength="128"
                     autocomplete="new-password"
                     placeholder="Contrase√±a">
              <button type="button"
                      class="ss-reg__pass-toggle"
                      id="togglePass"
                      aria-label="Mostrar contrase√±a"
                      aria-pressed="false">üëÅ</button>
            </div>

            <div class="ss-reg__meter" id="meterBox" aria-hidden="true"><span id="meter"></span></div>
            <div class="ss-reg__rules" id="passRules">
              <span id="rLen">‚Ä¢ 8+ caracteres</span>
              <span id="rMix">‚Ä¢ Letras y n√∫meros</span>
              <span id="rUp">‚Ä¢ May√∫scula recomendada</span>
              <span id="rSym">‚Ä¢ S√≠mbolo recomendado</span>
            </div>
          </div>

          <div class="ss-reg__field">
            <label for="password2">
              <span>Confirmar</span>
              <span class="ss-reg__hint">Debe coincidir</span>
            </label>

            <div class="ss-reg__pass-wrap">
              <input class="ss-reg__input"
                     id="password2"
                     type="password"
                     name="password2"
                     required
                     minlength="8"
                     maxlength="128"
                     autocomplete="new-password"
                     placeholder="Confirmar contrase√±a">
              <button type="button"
                      class="ss-reg__pass-toggle"
                      id="togglePass2"
                      aria-label="Mostrar confirmaci√≥n"
                      aria-pressed="false">üëÅ</button>
            </div>

            <div class="ss-reg__match" id="matchHint">‚Ä¢ Debe coincidir</div>
          </div>
        </div>

        <!-- Affiliate -->
        <div class="ss-reg__aff" aria-label="Programa de afiliados">
          <div class="ss-reg__aff-head">
            <b>Programa de Afiliados</b>

            <label class="ss-reg__switch" aria-label="Activar afiliados">
              <input type="checkbox" name="want_affiliate" id="wantAffiliate"
                     {% if request.form.get('want_affiliate') %}checked{% endif %}>
              <span class="ss-reg__toggle" aria-hidden="true"></span>
            </label>
          </div>

          <div class="ss-reg__aff-body" id="affBody">
            <div class="ss-reg__grid2" style="padding:0; gap:12px;">
              <div class="ss-reg__field">
                <label for="affiliate_display_name"><span>Nombre p√∫blico</span><span class="ss-reg__hint">Recomendado</span></label>
                <input class="ss-reg__input"
                       id="affiliate_display_name"
                       type="text"
                       name="affiliate_display_name"
                       maxlength="120"
                       autocomplete="nickname"
                       value="{{ request.form.get('affiliate_display_name','') if request.method=='POST' else '' }}"
                       placeholder="Nombre p√∫blico">
              </div>

              <div class="ss-reg__field">
                <label for="affiliate_instagram"><span>Red / Web</span><span class="ss-reg__hint">Opcional</span></label>
                <input class="ss-reg__input"
                       id="affiliate_instagram"
                       type="text"
                       name="affiliate_instagram"
                       maxlength="120"
                       value="{{ request.form.get('affiliate_instagram','') if request.method=='POST' else '' }}"
                       placeholder="Instagram / TikTok / Web">
              </div>
            </div>
          </div>
        </div>

        <button class="ss-reg__submit" id="submitBtn" type="submit">Crear cuenta</button>

        <div class="ss-reg__footer">
          Al crear tu cuenta acept√°s los <a href="{{ url_for('main.about') }}">T√©rminos</a> y la
          <a href="{{ url_for('main.contact') }}">Pol√≠tica de privacidad</a>.
          Nunca compartimos tus datos.
        </div>
      </form>
    </div>

  </div>
</section>

<script defer src="{{ url_for('static', filename='js/register.js') }}"></script>
{% endblock %}
