{% extends "base.html" %}
{% block title %}Skyline Store · Moda urbana premium{% endblock %}

{% block extra_head %}
<!-- =========================
 SEO / SHARE / PERFORMANCE
========================= -->
<meta name="description" content="{{ meta_description if meta_description is defined else 'Skyline Store · Moda urbana premium, accesorios y tecnología. Comprá fácil, rápido y seguro.' }}">
<link rel="canonical" href="{{ request.url }}">

<meta property="og:title" content="{{ meta_title if meta_title is defined else 'Skyline Store · Moda urbana premium' }}">
<meta property="og:description" content="{{ meta_description if meta_description is defined else 'Moda urbana, accesorios y tecnología en un solo lugar.' }}">
<meta property="og:image" content="{{ (og_image if og_image is defined else url_for('static', filename='img/banners/hero_home.png', _external=True)) }}">
<meta property="og:type" content="website">

<meta http-equiv="X-Content-Type-Options" content="nosniff">
<meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">

<link rel="preload" as="image" href="{{ url_for('static', filename='img/banners/hero_home.png') }}">

<style>
/* =========================
 TOKENS / BASE
========================= */
:root{
  --bg:#f6f7fb;
  --card:#ffffff;
  --text:#0b1220;
  --muted: rgba(11,18,32,.66);
  --line: rgba(15,23,42,.10);
  --shadow: 0 14px 40px rgba(2,6,23,.10);
  --shadow2: 0 10px 26px rgba(2,6,23,.08);
  --brand:#f59e0b;
  --brand2:#2563eb;
  --radius:18px;
}
*{box-sizing:border-box}
.home{background:var(--bg)}
.section{max-width:1220px;margin:0 auto;padding:0 18px 28px}
a{color:inherit}
.sr-only{position:absolute;left:-9999px;width:1px;height:1px;overflow:hidden}

/* =========================
 TOPBAR (Temu-like)
========================= */
.topbar{
  margin:14px 0 10px;
  display:flex; gap:10px; flex-wrap:wrap;
  align-items:center; justify-content:space-between;
}
.badges{
  display:flex; gap:8px; flex-wrap:wrap; align-items:center;
}
.badge{
  display:inline-flex; align-items:center; gap:8px;
  background:rgba(255,255,255,.88);
  border:1px solid var(--line);
  border-radius:999px;
  padding:8px 10px;
  box-shadow: 0 8px 18px rgba(2,6,23,.06);
  font-weight:900;
  font-size:.86rem;
  color: rgba(11,18,32,.86);
}
.badge i{
  width:10px;height:10px;border-radius:99px;background:rgba(34,197,94,.35);
  display:inline-block;
}
.badge.blue i{background:rgba(37,99,235,.30)}
.badge.amber i{background:rgba(245,158,11,.35)}
.badge.gray i{background:rgba(100,116,139,.30)}

/* =========================
 SEARCH (quick)
========================= */
.searchbar{
  display:flex; gap:10px; align-items:center;
  width:min(540px, 100%);
}
.search{
  flex:1;
  display:flex; gap:10px; align-items:center;
  background:rgba(255,255,255,.94);
  border:1px solid var(--line);
  border-radius:14px;
  padding:10px 12px;
  box-shadow: 0 10px 26px rgba(2,6,23,.06);
}
.search input{
  border:0; outline:none; width:100%;
  font-weight:900;
  background:transparent;
  color: var(--text);
}
.search button{
  border:0;
  background:var(--brand2);
  color:#fff;
  font-weight:1000;
  padding:10px 12px;
  border-radius:12px;
  cursor:pointer;
}
.search button:active{transform:translateY(1px)}

/* =========================
 HERO
========================= */
.hero-wrap{padding:8px 0 12px}
.hero{
  position:relative;
  border-radius:var(--radius);
  overflow:hidden;
  background:var(--card);
  box-shadow:var(--shadow);
  border:1px solid var(--line);
}
.hero-img{
  width:100%;
  height:min(480px,64vw);
  object-fit:cover;
  display:block;
}
.hero-overlay{
  position:absolute; inset:0;
  display:flex; align-items:center;
  padding:22px clamp(18px,4vw,46px);
}
.hero-left{
  max-width:560px;
  background:linear-gradient(180deg,rgba(255,255,255,.90),rgba(255,255,255,.64));
  border:1px solid var(--line);
  box-shadow:0 18px 50px rgba(2,6,23,.10);
  border-radius:18px;
  padding:18px 18px 16px;
  backdrop-filter: blur(6px);
}
.hero-left h1{
  margin:0;
  font-weight:1000;
  letter-spacing:-1px;
  line-height:1.02;
  font-size:clamp(2rem,4.8vw,3.35rem);
  color:var(--text);
}
.hero-left h1 .accent{color:var(--brand)}
.hero-sub{
  margin-top:10px;
  font-weight:900;
  color:rgba(11,18,32,.68);
  line-height:1.35;
}
.hero-ctas{display:flex;gap:10px;flex-wrap:wrap;margin-top:14px}
.btn{
  display:inline-flex;align-items:center;justify-content:center;
  text-decoration:none;font-weight:1000;
  padding:12px 14px;border-radius:12px;
  border:1px solid var(--line);
  cursor:pointer;
  transition: transform .18s cubic-bezier(.2,.9,.2,1);
}
.btn:hover{transform:translateY(-2px)}
.btn.primary{
  background:var(--brand);
  color:#111827;
  border-color: rgba(245,158,11,.35);
  box-shadow:0 14px 30px rgba(245,158,11,.18);
}
.btn.ghost{
  background:rgba(255,255,255,.85);
  color:var(--text);
}
.hero-mini{
  display:flex; gap:10px; flex-wrap:wrap;
  margin-top:12px;
}
.pill{
  display:inline-flex;align-items:center;gap:8px;
  padding:8px 10px;border-radius:999px;
  background:rgba(255,255,255,.86);
  border:1px solid rgba(15,23,42,.10);
  font-weight:1000;
  color:rgba(11,18,32,.75);
  font-size:.86rem;
}
.pill b{color:var(--text)}

/* =========================
 CATEGORÍAS (snap en mobile)
========================= */
.cats{
  display:grid;grid-template-columns:1fr;
  gap:12px;margin:14px 0 10px;
}
@media (min-width:860px){.cats{grid-template-columns:repeat(4,1fr)}}
@media (max-width:859px){
  .cats{
    display:flex;
    overflow:auto;
    scroll-snap-type:x mandatory;
    padding-bottom:4px;
  }
  .cat{min-width:78%; scroll-snap-align:start}
}
.cat{
  position:relative;border-radius:14px;overflow:hidden;
  border:1px solid var(--line);
  box-shadow:var(--shadow2);
  min-height:130px;
  background:var(--card);
}
.cat img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover}
.cat .layer{position:absolute;inset:0;background:linear-gradient(90deg,rgba(0,0,0,.35),transparent)}
.cat .content{position:absolute;left:12px;bottom:12px;right:12px;color:#fff}
.cat .content b{display:block;font-weight:1000;font-size:1.05rem}
.cat .content a{
  margin-top:6px;display:inline-flex;
  color:#fff;text-decoration:none;
  font-weight:1000;
  background:rgba(255,255,255,.16);
  border:1px solid rgba(255,255,255,.22);
  padding:8px 10px;border-radius:10px
}

/* =========================
 QUICK FILTERS (chips)
========================= */
.filters{
  display:flex; gap:8px; flex-wrap:wrap;
  margin:10px 0 14px;
}
.chip{
  display:inline-flex; align-items:center; gap:8px;
  padding:9px 12px;
  border-radius:999px;
  background:rgba(255,255,255,.90);
  border:1px solid var(--line);
  box-shadow: 0 8px 18px rgba(2,6,23,.05);
  text-decoration:none;
  font-weight:1000;
  color: rgba(11,18,32,.85);
}
.chip i{width:8px;height:8px;border-radius:99px;background:rgba(245,158,11,.40)}
.chip.blue i{background:rgba(37,99,235,.30)}
.chip.green i{background:rgba(34,197,94,.30)}
.chip.violet i{background:rgba(168,85,247,.30)}

/* =========================
 DESTACADOS
========================= */
.block-head{
  margin:10px 0 10px;
  display:flex; align-items:flex-end; justify-content:space-between;
  gap:10px;
}
.block-title{
  font-weight:1000;
  letter-spacing:-.4px;
  color:var(--text);
  font-size:1.18rem;
}
.block-sub{
  font-weight:900;
  color:rgba(11,18,32,.58);
  font-size:.9rem;
}
.gridP{display:grid;grid-template-columns:1fr;gap:12px}
@media (min-width:860px){.gridP{grid-template-columns:repeat(4,1fr)}}

.cardP{
  background:var(--card);
  border:1px solid var(--line);
  box-shadow:var(--shadow2);
  border-radius:14px;
  overflow:hidden;
  transition: transform .2s cubic-bezier(.2,.9,.2,1);
  display:flex;
  flex-direction:column;
}
.cardP:hover{transform:translateY(-4px)}
.ph{
  background:#f1f5f9;height:170px;
  position:relative;display:grid;place-items:center;
  overflow:hidden;
}
.ph img{width:100%;height:100%;object-fit:cover;display:block}
.sk{
  position:absolute;inset:0;
  background:linear-gradient(90deg,rgba(226,232,240,.55) 0%,rgba(226,232,240,.25) 45%,rgba(226,232,240,.55) 100%);
  background-size:200% 100%;
  animation:sk 1.1s ease-in-out infinite;
}
@keyframes sk{0%{background-position:0% 0}100%{background-position:200% 0}}
.fallback{
  position:absolute;inset:0;display:none;
  place-items:center;text-align:center;
  padding:12px;
  font-weight:1000;
  color:rgba(11,18,32,.72);
}
.body{padding:12px;display:flex;flex-direction:column;gap:8px;flex:1}
.name{font-weight:1000;color:var(--text);line-height:1.2}
.price{font-weight:1000;color:var(--text)}
.row{
  display:flex;align-items:center;justify-content:space-between;gap:10px
}
.buy{
  margin-top:auto;
  display:inline-flex;align-items:center;justify-content:center;
  text-decoration:none;
  font-weight:1000;
  background:var(--brand);
  color:#111827;
  padding:11px 12px;
  border-radius:12px;
  border:1px solid rgba(245,158,11,.35);
}
.buy:active{transform:translateY(1px)}

/* =========================
 SERVICES
========================= */
.services{
  margin-top:14px;
  display:grid;grid-template-columns:1fr;gap:10px;
  background:var(--card);
  border:1px solid var(--line);
  border-radius:14px;
  padding:10px;
  box-shadow:var(--shadow2);
}
@media (min-width:860px){.services{grid-template-columns:repeat(3,1fr)}}
.svc{display:flex;gap:10px;align-items:center;padding:8px;border-radius:12px}
.svc img{width:54px;height:54px;object-fit:contain}
.svc b{display:block;font-weight:1000;color:var(--text)}
.svc span{display:block;color:rgba(11,18,32,.66);font-size:.92rem;font-weight:800}

/* =========================
 FLOATING TOP BUTTON
========================= */
.to-top{
  position:fixed;
  right:16px;
  bottom:18px;
  z-index:50;
  display:none;
  width:44px;height:44px;
  border-radius:999px;
  background:rgba(255,255,255,.92);
  border:1px solid var(--line);
  box-shadow:0 14px 30px rgba(2,6,23,.14);
  font-weight:1000;
  cursor:pointer;
}
.to-top.show{display:grid;place-items:center}
</style>
{% endblock %}

{% block content %}
<div class="home">
  <div class="section">

    <!-- TOPBAR -->
    <div class="topbar" aria-label="Beneficios de la tienda">
      <div class="badges">
        <span class="badge green"><i></i> Envío rápido</span>
        <span class="badge blue"><i></i> Pago seguro</span>
        <span class="badge amber"><i></i> Soporte 24/7</span>
        <span class="badge gray"><i></i> Compra protegida</span>
      </div>

      <!-- SEARCH -->
      <form class="searchbar" action="{{ url_for('shop.shop') }}" method="get" role="search" aria-label="Buscar productos">
        <div class="search">
          <label class="sr-only" for="q">Buscar</label>
          <input id="q" name="q" placeholder="Buscar en Skyline Store…" autocomplete="off">
          <button type="submit">Buscar</button>
        </div>
      </form>
    </div>

    <!-- HERO -->
    <div class="hero-wrap">
      <div class="hero" aria-label="Hero principal">
        <img class="hero-img"
             src="{{ url_for('static', filename='img/banners/hero_home.png') }}"
             alt="Nueva colección urbana Skyline Store"
             loading="eager" decoding="async">
        <div class="hero-overlay">
          <div class="hero-left">
            <h1>NUEVA<br>COLECCIÓN<br><span class="accent">URBANA</span></h1>
            <div class="hero-sub">
              Tendencias + productos top. Comprá fácil, rápido y seguro.
            </div>
            <div class="hero-ctas">
              <a class="btn primary" href="{{ url_for('shop.shop') }}">COMPRAR AHORA</a>
              <a class="btn ghost" href="{{ url_for('shop.shop') }}?sort=new">VER NOVEDADES</a>
            </div>
            <div class="hero-mini" aria-label="Highlights">
              <span class="pill"><b>+100</b> productos</span>
              <span class="pill"><b>Ofertas</b> semanales</span>
              <span class="pill"><b>Seguimiento</b> de pedidos</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- CATEGORÍAS -->
    <div class="cats" aria-label="Categorías principales">
      <div class="cat">
        <img src="{{ url_for('static', filename='img/banners/cat_men.png') }}" alt="Moda masculina" loading="lazy" decoding="async">
        <div class="layer"></div>
        <div class="content">
          <b>Moda Masculina</b>
          <a href="{{ url_for('shop.shop') }}?categoria=ropa&sub=masculina">VER MÁS</a>
        </div>
      </div>
      <div class="cat">
        <img src="{{ url_for('static', filename='img/banners/cat_women.png') }}" alt="Moda femenina" loading="lazy" decoding="async">
        <div class="layer"></div>
        <div class="content">
          <b>Moda Femenina</b>
          <a href="{{ url_for('shop.shop') }}?categoria=ropa&sub=femenina">VER MÁS</a>
        </div>
      </div>
      <div class="cat">
        <img src="{{ url_for('static', filename='img/banners/cat_accessories.png') }}" alt="Accesorios" loading="lazy" decoding="async">
        <div class="layer"></div>
        <div class="content">
          <b>Accesorios</b>
          <a href="{{ url_for('shop.shop') }}?categoria=accesorios">VER MÁS</a>
        </div>
      </div>
      <div class="cat">
        <img src="{{ url_for('static', filename='img/banners/cat_tech.png') }}" alt="Gadgets y tecnología" loading="lazy" decoding="async">
        <div class="layer"></div>
        <div class="content">
          <b>Gadgets & Tech</b>
          <a href="{{ url_for('shop.shop') }}?categoria=tecnologia">VER MÁS</a>
        </div>
      </div>
    </div>

    <!-- QUICK FILTERS -->
    <div class="filters" aria-label="Filtros rápidos">
      <a class="chip" href="{{ url_for('shop.shop') }}?sort=new"><i></i> Novedades</a>
      <a class="chip blue" href="{{ url_for('shop.shop') }}?q=oferta"><i></i> Ofertas</a>
      <a class="chip green" href="{{ url_for('shop.shop') }}?available=1"><i></i> Disponibles</a>
      <a class="chip violet" href="{{ url_for('shop.shop') }}?categoria=tecnologia"><i></i> Tech</a>
    </div>

    <!-- DESTACADOS -->
    <div class="block-head">
      <div>
        <div class="block-title">PRODUCTOS DESTACADOS</div>
        <div class="block-sub">Selección premium — lo más buscado hoy</div>
      </div>
      <div class="block-sub">Actualiza automáticamente</div>
    </div>

    {% set featured_list = featured if featured is defined and featured is iterable else [] %}

    <div class="gridP" aria-label="Productos destacados">
      {% for p in featured_list %}
      <article class="cardP" aria-label="Producto destacado">
        <div class="ph">
          <div class="sk" aria-hidden="true"></div>

          {% if p.img and (p.img.startswith('http://') or p.img.startswith('https://')) %}
            <img src="{{ p.img }}" alt="{{ p.title }}" loading="lazy" decoding="async" data-fallback="1">
          {% else %}
            <img src="{{ url_for('static', filename='img/products/' ~ (p.img or 'hero-placeholder.png')) }}"
                 alt="{{ p.title }}" loading="lazy" decoding="async" data-fallback="1">
          {% endif %}

          <div class="fallback" aria-hidden="true">
            {{ p.title }}<br>
            <span style="opacity:.7;font-size:.9rem;">Imagen no disponible</span>
          </div>
        </div>

        <div class="body">
          <div class="row">
            <div class="price">{{ p.price }}</div>
          </div>
          <div class="name">{{ p.title }}</div>
          <a class="buy" href="{{ p.href }}">COMPRAR</a>
        </div>
      </article>
      {% endfor %}
    </div>

    {% if featured_list|length == 0 %}
    <div style="margin-top:12px;padding:14px;background:#fff;border:1px solid rgba(15,23,42,.10);border-radius:14px;box-shadow:0 10px 26px rgba(2,6,23,.08);font-weight:900;color:rgba(11,18,32,.70)">
      No hay destacados aún. Agregá productos activos y se mostrarán automáticamente.
    </div>
    {% endif %}

    <!-- SERVICIOS -->
    <div class="services" aria-label="Servicios">
      <div class="svc">
        <img src="{{ url_for('static', filename='img/banners/service_shipping.png') }}" alt="Envío rápido" loading="lazy" decoding="async">
        <div><b>ENVÍO RÁPIDO</b><span>Entrega ágil y seguimiento</span></div>
      </div>
      <div class="svc">
        <img src="{{ url_for('static', filename='img/banners/service_payment.png') }}" alt="Pago seguro" loading="lazy" decoding="async">
        <div><b>PAGO SEGURO</b><span>Plataformas certificadas</span></div>
      </div>
      <div class="svc">
        <img src="{{ url_for('static', filename='img/banners/service_support.png') }}" alt="Soporte 24/7" loading="lazy" decoding="async">
        <div><b>SOPORTE 24/7</b><span>Atención al cliente</span></div>
      </div>
    </div>

  </div>
</div>

<button class="to-top" id="toTop" aria-label="Subir">↑</button>

<script>
/* Skeleton + fallback */
(function(){
  document.querySelectorAll('img[data-fallback="1"]').forEach(img=>{
    const ph = img.closest('.ph');
    const sk = ph ? ph.querySelector('.sk') : null;
    const fb = ph ? ph.querySelector('.fallback') : null;

    const ok = () => { if(sk) sk.style.display='none'; };
    const bad = () => {
      img.style.display='none';
      if(fb) fb.style.display='grid';
      ok();
    };

    img.addEventListener('load', ok, {once:true});
    img.addEventListener('error', bad, {once:true});

    if(img.complete){
      (img.naturalWidth > 0) ? ok() : bad();
    }
  });
})();

/* Floating "to top" */
(function(){
  const btn = document.getElementById('toTop');
  if(!btn) return;

  const onScroll = () => {
    if(window.scrollY > 500) btn.classList.add('show');
    else btn.classList.remove('show');
  };
  window.addEventListener('scroll', onScroll, {passive:true});
  onScroll();

  btn.addEventListener('click', () => window.scrollTo({top:0, behavior:'smooth'}));
})();
</script>
{% endblock %}
