<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  {% set _req = (request if request is defined and request else none) %}
  {% set _args = (_req.args if _req and _req.args else {}) %}
  {% set _path = (_req.path if _req and _req.path else '') %}
  {% set _env = (ENV if ENV is defined and ENV else 'production')|string|lower|trim %}

  {% set _app = (APP_NAME if APP_NAME is defined and APP_NAME else "Skyline Store")|string %}
  {% set _title = (meta_title if meta_title is defined and meta_title else _app)|string %}
  {% set _desc  = (meta_description if meta_description is defined and meta_description else "Marketplace premium de tecnologÃ­a y streetwear.")|string %}

  {% set _cssv = (BASE_CSS_VER if BASE_CSS_VER is defined and BASE_CSS_VER else (ASSET_VER if ASSET_VER is defined and ASSET_VER else '6'))|string|trim %}
  {% set _nonce = (csp_nonce if csp_nonce is defined and csp_nonce else (nonce if nonce is defined and nonce else '')) %}

  {% set _vf = (view_functions if view_functions is defined and view_functions else {}) %}

  {% macro safe_static(filename) -%}
    {%- if url_for is defined -%}{{ url_for('static', filename=filename) ~ '?v=' ~ _cssv }}{%- else -%}{{ '' }}{%- endif -%}
  {%- endmacro %}

  {% macro safe_url(endpoint, fallback='/', **kwargs) -%}
    {%- if url_for is not defined or not endpoint -%}{{ fallback }}
    {%- elif endpoint in _vf -%}{{ url_for(endpoint, **kwargs) }}
    {%- else -%}{{ fallback }}
    {%- endif -%}
  {%- endmacro %}

  {% set _csrf = '' %}
  {% if csrf_token_value is defined and csrf_token_value %}
    {% set _csrf = csrf_token_value %}
  {% elif csrf_token is defined and csrf_token %}
    {% if csrf_token is callable %}
      {% set _csrf = csrf_token() %}
    {% else %}
      {% set _csrf = csrf_token %}
    {% endif %}
  {% endif %}

  {% set _canonical = (_req.base_url if _req and _req.base_url else 'https://skyline-style.onrender.com/') %}
  {% set _url_root = (_req.url_root if _req and _req.url_root else 'https://skyline-style.onrender.com/') %}

  {% set _og = (og_image if og_image is defined and og_image else (safe_url('static', '', filename='img/og/og-home.png') if url_for is defined else '')) %}
  {% if _og and _og.startswith('/') and _url_root and _url_root.startswith('http') %}
    {% set _og = _url_root ~ _og.lstrip('/') %}
  {% endif %}

  <title>{% block title %}{{ _title|e }}{% endblock %}</title>
  <meta name="description" content="{{ _desc|e }}">
  <meta name="robots" content="{{ 'index,follow' if _env == 'production' else 'noindex,nofollow' }}">
  <link rel="canonical" href="{{ _canonical|e }}">

  <meta property="og:title" content="{{ _title|e }}">
  <meta property="og:description" content="{{ _desc|e }}">
  <meta property="og:type" content="website">
  <meta property="og:locale" content="es_UY">
  <meta property="og:url" content="{{ _canonical|e }}">
  {% if _og %}<meta property="og:image" content="{{ _og|e }}">{% endif %}
  <meta property="og:image:alt" content="{{ _title|e }}">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="{{ _title|e }}">
  <meta name="twitter:description" content="{{ _desc|e }}">
  {% if _og %}<meta name="twitter:image" content="{{ _og|e }}">{% endif %}

  <meta name="theme-color" content="#2563eb">
  <meta name="color-scheme" content="light dark">
  <meta name="referrer" content="strict-origin-when-cross-origin">
  <meta name="csrf-token" content="{{ (_csrf|string)|e }}">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">

  {% set _base_css = safe_static('css/skyline-pro.css') %}
  {% if _base_css %}
    <link rel="preload" as="style" href="{{ _base_css|e }}">
    <link rel="stylesheet" href="{{ _base_css|e }}">
  {% endif %}

  <style>
    :root{
      --sb-bg: rgba(255,255,255,.78);
      --sb-bg2: rgba(255,255,255,.60);
      --sb-br: rgba(15,23,42,.12);
      --sb-ink: #0b1220;
      --sb-muted:#5b6b82;
      --sb-p: #2563eb;
      --sb-p2:#0ea5e9;
      --sb-acc:#f59e0b;
      --sb-r: 18px;
      --sb-sh: 0 14px 40px rgba(2,8,23,.10);
      --sb-ring: 0 0 0 3px rgba(37,99,235,.20);
      --sb-max: 1200px;
      --sb-gap: 14px;
      --sb-surface: rgba(255,255,255,.42);
      --sb-surface2: rgba(255,255,255,.55);
      --sb-hit: 44px;
    }
    @media (prefers-color-scheme: dark){
      :root{
        --sb-bg: rgba(2,8,23,.62);
        --sb-bg2: rgba(2,8,23,.48);
        --sb-br: rgba(148,163,184,.16);
        --sb-ink:#e8eefc;
        --sb-muted:#a9b7d3;
        --sb-sh: 0 16px 48px rgba(0,0,0,.32);
        --sb-surface: rgba(2,8,23,.45);
        --sb-surface2: rgba(2,8,23,.52);
      }
    }
    *,*::before,*::after{ box-sizing:border-box; }
    html{ -webkit-text-size-adjust:100%; text-size-adjust:100%; scroll-behavior:smooth; }
    body{ margin:0; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; color: var(--sb-ink); background: transparent; }
    img{ max-width:100%; height:auto; }
    a{ color:inherit; }
    :focus-visible{ outline:none; box-shadow: var(--sb-ring); border-radius: 14px; }
    .skip{ position:absolute; left:-9999px; top:10px; background:#fff; color:#111; padding:10px 12px; border-radius:12px; z-index:9999; box-shadow: var(--sb-sh); }
    .skip:focus{ left:10px; }
    .container{ max-width: var(--sb-max); margin: 0 auto; padding: 0 16px; }
    .topbar{
      position: sticky; top: 0; z-index: 50;
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      background: linear-gradient(180deg, var(--sb-bg), var(--sb-bg2));
      border-bottom: 1px solid var(--sb-br);
    }
    .topbar-inner{
      max-width: var(--sb-max);
      margin: 0 auto;
      padding: 12px 16px;
      display:flex;
      align-items:center;
      gap: var(--sb-gap);
      flex-wrap: wrap;
    }
    .brand{
      display:flex; align-items:center; gap:12px;
      text-decoration:none; color: var(--sb-ink);
      min-width: 220px;
    }
    .brand-dot{
      width: 12px; height: 12px; border-radius: 999px;
      background: radial-gradient(circle at 30% 30%, var(--sb-acc), var(--sb-p));
      box-shadow: 0 0 0 6px rgba(37,99,235,.10);
      flex: 0 0 auto;
    }
    .brand-txt{ display:flex; flex-direction:column; line-height:1.05; }
    .brand-name{ font-weight: 900; letter-spacing: .2px; }
    .brand-sub{ font-size: .82rem; color: var(--sb-muted); font-weight:700; }
    .nav{ display:flex; gap: 10px; align-items:center; flex-wrap: wrap; }
    .nav a{
      text-decoration:none;
      color: var(--sb-muted);
      font-weight: 800;
      padding: 10px 12px;
      border-radius: 999px;
      transition: transform .15s ease, background .15s ease, color .15s ease;
      min-height: var(--sb-hit);
      display:inline-flex;
      align-items:center;
    }
    .nav a:hover{ background: rgba(37,99,235,.10); color: var(--sb-ink); transform: translateY(-1px); }
    .nav a.active{ background: rgba(37,99,235,.14); color: var(--sb-ink); }
    .search{
      flex:1 1 320px;
      display:flex;
      align-items:center;
      gap:10px;
      padding: 10px 12px;
      border: 1px solid var(--sb-br);
      border-radius: 999px;
      background: var(--sb-surface);
      min-width: 260px;
    }
    .search span{ color: var(--sb-muted); font-weight: 900; }
    .search input{
      width:100%;
      border:0; outline:0;
      background: transparent;
      color: var(--sb-ink);
      font-weight: 700;
      font-size: .98rem;
      min-height: 24px;
    }
    .search input::placeholder{ color: var(--sb-muted); font-weight: 700; }
    .btn{
      appearance:none;
      border:0;
      cursor:pointer;
      border-radius: 999px;
      padding: 10px 14px;
      font-weight: 900;
      letter-spacing:.2px;
      transition: transform .15s ease, box-shadow .15s ease, filter .15s ease;
      user-select:none;
      white-space: nowrap;
      min-height: var(--sb-hit);
      display:inline-flex;
      align-items:center;
      justify-content:center;
    }
    .btn.primary{
      color:#fff;
      background: linear-gradient(135deg, var(--sb-p), var(--sb-p2));
      box-shadow: 0 12px 30px rgba(37,99,235,.22);
    }
    .btn.primary:hover{ transform: translateY(-1px); filter: brightness(1.03); }
    .btn.primary:active{ transform: translateY(0); filter: brightness(.98); }
    .topbar-actions{ display:flex; gap: 10px; align-items:center; margin-left: auto; }
    .icon-btn{
      position: relative;
      display:inline-flex; align-items:center; justify-content:center;
      width: var(--sb-hit); height: var(--sb-hit);
      border-radius: 999px;
      border: 1px solid var(--sb-br);
      background: var(--sb-surface);
      text-decoration:none;
      color: var(--sb-ink);
      transition: transform .15s ease, background .15s ease;
      flex: 0 0 auto;
    }
    .icon-btn:hover{ transform: translateY(-1px); background: rgba(37,99,235,.10); }
    .cart-badge{
      position:absolute; top: -6px; right: -6px;
      min-width: 18px; height: 18px;
      padding: 0 6px;
      border-radius: 999px;
      background: #ef4444;
      color:#fff;
      font-size: 12px;
      font-weight: 900;
      display:flex; align-items:center; justify-content:center;
      box-shadow: 0 10px 24px rgba(239,68,68,.25);
    }
    .account-link{
      display:flex;
      gap:10px;
      align-items:center;
      text-decoration:none;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid var(--sb-br);
      background: var(--sb-surface);
      color: var(--sb-ink);
      transition: transform .15s ease, background .15s ease;
      min-height: var(--sb-hit);
    }
    .account-link:hover{ transform: translateY(-1px); background: rgba(37,99,235,.10); }
    .account-link .icon{ width: 30px; height: 30px; display:flex; align-items:center; justify-content:center; }
    .account-link .txt{ display:flex; flex-direction:column; line-height:1.05; }
    .account-link strong{ font-weight: 900; font-size: .92rem; }
    .account-link small{ color: var(--sb-muted); font-weight: 800; font-size: .78rem; }
    main.container{ padding-top: 18px; padding-bottom: 40px; min-height: 50vh; }
    .footer{
      border-top: 1px solid var(--sb-br);
      background: linear-gradient(180deg, var(--sb-surface2), rgba(255,255,255,.40));
      padding: 26px 0;
      margin-top: 34px;
    }
    @media (prefers-color-scheme: dark){
      .footer{ background: linear-gradient(180deg, rgba(2,8,23,.60), rgba(2,8,23,.42)); }
    }
    .grid-4{
      display:grid;
      grid-template-columns: repeat(4, minmax(0,1fr));
      gap: 14px;
    }
    .footer a{ color: var(--sb-muted); text-decoration:none; font-weight:800; }
    .footer a:hover{ color: var(--sb-ink); text-decoration: underline; }
    .small{ color: var(--sb-muted); font-weight: 700; font-size: .92rem; }
    .muted{ color: var(--sb-muted); }
    @media (max-width: 980px){
      .grid-4{ grid-template-columns: repeat(2, minmax(0,1fr)); }
    }
    @media (max-width: 520px){
      .grid-4{ grid-template-columns: 1fr; }
      .btn.primary{ width: 100%; }
      .topbar-actions{ width: 100%; justify-content: flex-end; }
      .brand-sub{ display:none; }
      .search{ min-width: 0; flex: 1 1 100%; }
    }
    @media (prefers-reduced-motion: reduce){
      html{ scroll-behavior:auto !important; }
      *{ transition:none !important; animation:none !important; }
    }
  </style>

  {% block extra_head %}{% endblock %}
</head>

<body>
<a href="#main" class="skip">Saltar al contenido</a>

{% set home = safe_url('main.home', '/') %}
{% set shop = safe_url('shop.shop', '/shop') %}
{% set cart = safe_url('cart.cart_view', '/cart') %}
{% set account = safe_url('auth.account', '/auth/account') %}
{% set login = account ~ '?tab=login' %}
{% set register = account ~ '?tab=register' %}

{% set user_ok = false %}
{% if current_user is defined and current_user %}
  {% if current_user.is_authenticated is defined and current_user.is_authenticated %}
    {% set user_ok = true %}
  {% endif %}
{% endif %}

<header class="topbar" role="banner">
  <div class="topbar-inner">
    <a href="{{ home|e }}" class="brand" aria-label="Inicio">
      <span class="brand-dot" aria-hidden="true"></span>
      <span class="brand-txt">
        <span class="brand-name">{{ _app|e }}</span>
        <span class="brand-sub">Tech + Streetwear premium</span>
      </span>
    </a>

    <nav class="nav" aria-label="NavegaciÃ³n principal">
      <a href="{{ home|e }}" class="{% if _path == '/' %}active{% endif %}">Inicio</a>
      <a href="{{ shop|e }}" class="{% if _path.startswith('/shop') and not _args.get('ofertas') %}active{% endif %}">Tienda</a>
      <a href="{{ (shop ~ ('?ofertas=1' if '?' not in shop else '&ofertas=1'))|e }}" class="{% if _args.get('ofertas') %}active{% endif %}">Ofertas</a>
    </nav>

    <form class="search" action="{{ shop|e }}" method="get" role="search" aria-label="Buscar productos">
      <span aria-hidden="true">âŒ•</span>
      <input
        type="search"
        name="q"
        placeholder="Buscar productos..."
        value="{{ (_args.get('q','') if _args else '')|e }}"
        autocomplete="off"
        autocapitalize="none"
        spellcheck="false"
        inputmode="search"
      >
      <button type="submit" class="btn primary">Buscar</button>
    </form>

    <div class="topbar-actions">
      <a href="{{ cart|e }}" aria-label="Carrito" class="icon-btn">
        <span aria-hidden="true">ðŸ›’</span>
        <span class="cart-badge" data-cart-badge hidden>0</span>
      </a>

      <a href="{{ (account if user_ok else login)|e }}" class="account-link" aria-label="Mi cuenta">
        <span class="icon" aria-hidden="true">ðŸ‘¤</span>
        <span class="txt">
          <strong>Mi cuenta</strong>
          <small>{% if user_ok %}Panel{% else %}Entrar / Crear{% endif %}</small>
        </span>
      </a>
    </div>
  </div>
</header>

<main id="main" class="container" role="main">
  {% block content %}{% endblock %}
</main>

<footer class="footer" role="contentinfo">
  <div class="container grid-4">
    <div>
      <strong>{{ _app|e }}</strong>
      <p class="small">Marketplace premium de tecnologÃ­a y streetwear.</p>
      <p class="small muted">Soporte y polÃ­ticas claras.</p>
    </div>
    <div>
      <strong>Explorar</strong><br>
      <a href="{{ shop|e }}">Tienda</a><br>
      <a href="{{ (shop ~ ('?ofertas=1' if '?' not in shop else '&ofertas=1'))|e }}">Ofertas</a>
    </div>
    <div>
      <strong>Cuenta</strong><br>
      <a href="{{ login|e }}">Ingresar</a><br>
      <a href="{{ register|e }}">Crear cuenta</a>
    </div>
    <div>
      <strong>Legal</strong><br>
      <a href="{{ safe_url('main.terms','/terms')|e }}">TÃ©rminos</a><br>
      <a href="{{ safe_url('main.privacy','/privacy')|e }}">Privacidad</a>
    </div>
  </div>
  <p class="small container">Â© {{ (now_year if now_year is defined and now_year else 2026)|e }} {{ _app|e }}</p>
</footer>

<script{% if _nonce %} nonce="{{ _nonce|e }}"{% endif %}>
(() => {
  const meta = document.querySelector('meta[name="csrf-token"]');
  const token = meta && meta.content ? String(meta.content) : '';
  const badge = document.querySelector('[data-cart-badge]');
  const setBadge = (n) => {
    if (!badge) return;
    const v = Number(n || 0);
    badge.textContent = String(v);
    if (v > 0) badge.removeAttribute('hidden');
    else badge.setAttribute('hidden','');
  };
  const sameOrigin = (u) => {
    try { return new URL(u, window.location.href).origin === window.location.origin; }
    catch { return false; }
  };
  const origFetch = window.fetch;
  if (typeof origFetch === 'function') {
    window.fetch = (url, opts) => {
      try {
        const o = opts ? { ...opts } : {};
        const method = String(o.method || 'GET').toUpperCase();
        const headers = new Headers(o.headers || {});
        if (sameOrigin(url) && token && method !== 'GET' && method !== 'HEAD') {
          if (!headers.has('X-CSRFToken')) headers.set('X-CSRFToken', token);
          if (!headers.has('X-Requested-With')) headers.set('X-Requested-With', 'XMLHttpRequest');
        }
        o.headers = headers;
        if (!o.credentials) o.credentials = 'same-origin';
        return origFetch(url, o);
      } catch {
        return origFetch(url, opts);
      }
    };
  }
  try { document.documentElement.classList.add('js'); } catch {}
  window.Skyline = window.Skyline || {};
  window.Skyline.setCartBadge = setBadge;
})();
</script>

{% block extra_js %}{% endblock %}
</body>
</html>
