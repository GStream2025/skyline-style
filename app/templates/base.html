<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  {% set _req = (request if request is defined and request else none) %}
  {% set _args = (_req.args if _req and _req.args else {}) %}
  {% set _path = (_req.path if _req and _req.path else '/') %}
  {% set _env  = (ENV if ENV is defined and ENV else 'production')|lower|trim %}
  {% set _app  = (APP_NAME if APP_NAME is defined and APP_NAME else 'Skyline Store')|string %}
  {% set _title = (meta_title if meta_title is defined and meta_title else _app)|string %}
  {% set _desc  = (meta_description if meta_description is defined and meta_description else 'Marketplace premium de tecnologÃ­a y streetwear.')|string %}
  {% set _vf = (view_functions if view_functions is defined and view_functions else {}) %}
  {% set _cssv = (BASE_CSS_VER if BASE_CSS_VER is defined else (ASSET_VER if ASSET_VER is defined else '1'))|string %}
  {% set _nonce = (csp_nonce if csp_nonce is defined and csp_nonce else (nonce if nonce is defined else '')) %}

  {% macro safe_url(ep, fb='/') -%}
    {%- if url_for is defined and ep and ep in _vf -%}{{ url_for(ep) }}{%- else -%}{{ fb }}{%- endif -%}
  {%- endmacro %}

  {% macro safe_urlq(ep, fb='/', q='') -%}
    {%- set base = (url_for(ep) if url_for is defined and ep and ep in _vf else fb) -%}
    {%- set qs = (q|string)|trim -%}
    {%- if not base -%}{{ fb }}
    {%- elif qs -%}{{ base ~ ('&' if '?' in base else '?') ~ qs }}
    {%- else -%}{{ base }}
    {%- endif -%}
  {%- endmacro %}

  {% macro safe_static(f) -%}
    {%- if url_for is defined -%}{{ url_for('static', filename=f) ~ '?v=' ~ _cssv }}{%- else -%}{{ '' }}{%- endif -%}
  {%- endmacro %}

  {% set _csrf = '' %}
  {% if csrf_token_value is defined and csrf_token_value %}
    {% set _csrf = csrf_token_value %}
  {% elif csrf_token is defined and csrf_token is callable %}
    {% set _csrf = csrf_token() %}
  {% endif %}

  {% set _canonical = 'https://skyline-style.onrender.com' %}
  {% if _req and _req.url_root %}
    {% set _canonical = (_req.url_root.rstrip('/') ~ _path) %}
  {% endif %}

  {% set _og = (og_image if og_image is defined else safe_static('img/og/og-home.png')) %}
  {% set _q = (_args.get('q','') if _args else '') %}

  <title>{% block title %}{{ _title|e }}{% endblock %}</title>
  <meta name="description" content="{{ _desc|e }}">
  <meta name="robots" content="{{ 'index,follow' if _env == 'production' else 'noindex,nofollow' }}">
  <link rel="canonical" href="{{ _canonical|e }}">

  <meta property="og:type" content="website">
  <meta property="og:title" content="{{ _title|e }}">
  <meta property="og:description" content="{{ _desc|e }}">
  <meta property="og:url" content="{{ _canonical|e }}">
  {% if _og %}<meta property="og:image" content="{{ _og|e }}">{% endif %}

  <meta name="twitter:card" content="summary_large_image">
  <meta name="theme-color" content="#2563eb">
  <meta name="color-scheme" content="light dark">
  <meta name="referrer" content="strict-origin-when-cross-origin">
  <meta name="csrf-token" content="{{ _csrf|e }}">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">

  {% set _base_css = safe_static('css/skyline-pro.css') %}
  {% if _base_css %}
    <link rel="preload" as="style" href="{{ _base_css|e }}">
    <link rel="stylesheet" href="{{ _base_css|e }}">
  {% endif %}

  {% block extra_head %}{% endblock %}
</head>

<body>
<a href="#main" class="skip">Saltar al contenido</a>

{% set home = safe_url('main.home','/') %}
{% set shop = safe_url('shop.shop','/shop') %}
{% set cart = safe_url('cart.cart_view','/cart') %}
{% set account_panel = safe_url('auth.account','/auth/account') %}
{% set login_url = safe_url('auth.login', account_panel ~ '?tab=login') %}
{% set register_url = safe_url('auth.register', account_panel ~ '?tab=register') %}
{% set user_ok = (current_user is defined and current_user and current_user.is_authenticated is defined and current_user.is_authenticated) %}

<header class="topbar" role="banner">
  <div class="topbar-inner">
    <a href="{{ home|e }}" class="brand" aria-label="Inicio">
      <span class="brand-dot" aria-hidden="true"></span>
      <span class="brand-txt">
        <span class="brand-name">{{ _app|e }}</span>
        <span class="brand-sub">Tech + Streetwear premium</span>
      </span>
    </a>

    <nav class="nav" aria-label="NavegaciÃ³n principal">
      <a href="{{ home|e }}" {% if _path == '/' %}aria-current="page"{% endif %}>Inicio</a>
      <a href="{{ shop|e }}" {% if _path.startswith('/shop') %}aria-current="page"{% endif %}>Tienda</a>
      <a href="{{ (shop ~ '?ofertas=1')|e }}" {% if _args and _args.get('ofertas') %}aria-current="page"{% endif %}>Ofertas</a>
    </nav>

    <form class="search" action="{{ shop|e }}" method="get" role="search" autocomplete="off">
      <label class="sr-only" for="q">Buscar productos</label>
      <input id="q" type="search" name="q" placeholder="Buscar productosâ€¦" value="{{ _q|e }}" inputmode="search" maxlength="80">
      <button class="btn primary" type="submit">Buscar</button>
    </form>

    <div class="topbar-actions">
      <a href="{{ cart|e }}" class="icon-btn" aria-label="Carrito">
        ðŸ›’ <span class="cart-badge" data-cart-badge hidden>0</span>
      </a>

      {% if user_ok %}
        <a href="{{ account_panel|e }}" class="account-link" aria-label="Mi cuenta">
          ðŸ‘¤ <span class="txt"><strong>Mi cuenta</strong><small>Panel</small></span>
        </a>
      {% else %}
        <div class="account-cta" role="group" aria-label="Acceso a cuenta">
          <a href="{{ login_url|e }}" class="btn ghost" aria-label="Entrar">Entrar</a>
          <a href="{{ register_url|e }}" class="btn primary" aria-label="Crear cuenta">Crear</a>
        </div>
      {% endif %}
    </div>
  </div>
</header>

<main id="main" class="container" role="main" tabindex="-1">
  {% block content %}{% endblock %}
</main>

<footer class="footer" role="contentinfo">
  <div class="container grid-4">
    <div>
      <strong>{{ _app|e }}</strong>
      <p class="small">Marketplace premium de tecnologÃ­a y streetwear.</p>
    </div>
    <div>
      <strong>Explorar</strong><br>
      <a href="{{ shop|e }}">Tienda</a><br>
      <a href="{{ (shop ~ '?ofertas=1')|e }}">Ofertas</a>
    </div>
    <div>
      <strong>Cuenta</strong><br>
      <a href="{{ login_url|e }}">Ingresar</a><br>
      <a href="{{ register_url|e }}">Crear cuenta</a>
    </div>
    <div>
      <strong>Legal</strong><br>
      <a href="{{ safe_url('main.terms','/terms')|e }}">TÃ©rminos</a><br>
      <a href="{{ safe_url('main.privacy','/privacy')|e }}">Privacidad</a>
    </div>
  </div>
  <p class="small container">Â© {{ now_year|default(2026)|e }} {{ _app|e }}</p>
</footer>

<script{% if _nonce %} nonce="{{ _nonce|e }}"{% endif %}>
(() => {
  const meta = document.querySelector('meta[name="csrf-token"]');
  const token = meta && meta.content ? meta.content : '';
  const badge = document.querySelector('[data-cart-badge]');
  window.Skyline = window.Skyline || {};
  window.Skyline.setCartBadge = (n = 0) => {
    if (!badge) return;
    const num = Number(n) || 0;
    badge.textContent = String(num);
    if (num > 0) badge.removeAttribute('hidden');
    else badge.setAttribute('hidden', '');
  };
  const _fetch = window.fetch;
  if (_fetch && token) {
    window.fetch = (url, opts = {}) => {
      const o = Object.assign({}, opts);
      const m = String(o.method || 'GET').toUpperCase();
      const h = new Headers(o.headers || {});
      h.set('X-Requested-With', 'XMLHttpRequest');
      try {
        const u = new URL(String(url), window.location.href);
        if (u.origin === window.location.origin && !['GET','HEAD','OPTIONS'].includes(m)) {
          h.set('X-CSRFToken', token);
          if (!o.credentials) o.credentials = 'same-origin';
        }
      } catch (_) {}
      o.headers = h;
      return _fetch(url, o);
    };
  }
})();
</script>

{% block extra_js %}{% endblock %}
</body>
</html>
