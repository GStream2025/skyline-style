{% extends "base.html" %}
{% block title %}Mi cuenta Â· {{ (APP_NAME or "Skyline Store")|e }}{% endblock %}

{% block extra_head %}
  {% set _vf = (view_functions if view_functions is defined and view_functions else {}) %}
  {% set _shop = (url_for('shop.shop') if 'shop.shop' in _vf else '/shop') %}
  {% if not _shop or not _shop.startswith('/') %}{% set _shop = '/shop' %}{% endif %}
  {% set _offers = _shop ~ ('?ofertas=1' if '?' not in _shop else '&ofertas=1') %}
  {% set _new = _shop ~ ('?sort=new' if '?' not in _shop else '&sort=new') %}
  {% set _featured = '/#destacados' %}
  <meta name="robots" content="noindex,nofollow">
  <meta name="theme-color" content="#2563eb">
{% endblock %}

{% block content %}
{% set _vf = (view_functions if view_functions is defined and view_functions else {}) %}
{% set _shop = (url_for('shop.shop') if 'shop.shop' in _vf else '/shop') %}
{% if not _shop or not _shop.startswith('/') %}{% set _shop = '/shop' %}{% endif %}
{% set _offers = _shop ~ ('?ofertas=1' if '?' not in _shop else '&ofertas=1') %}
{% set _new = _shop ~ ('?sort=new' if '?' not in _shop else '&sort=new') %}
{% set _featured = '/#destacados' %}

{% set name = (user_name if user_name is defined and user_name else 'Skyline Guest')|string|trim %}
{% set orders = (orders_count if orders_count is defined and orders_count is not none else 0) %}
{% set favs = (favorites_count if favorites_count is defined and favorites_count is not none else 0) %}
{% set points = (skyline_points if skyline_points is defined and skyline_points is not none else 0) %}
{% set next_pts = (next_level_points if next_level_points is defined and next_level_points is not none else 500) %}
{% if next_pts < 1 %}{% set next_pts = 1 %}{% endif %}
{% set pct = ((points / next_pts) * 100)|round(0) %}
{% if pct < 0 %}{% set pct = 0 %}{% endif %}
{% if pct > 100 %}{% set pct = 100 %}{% endif %}

<main class="ss-page ss-profile" id="account" role="main" aria-label="Mi cuenta">
  <a class="ss-skip" href="#accountMain">Saltar al contenido</a>

  <section class="container ss-profile__wrap" id="accountMain" tabindex="-1">
    <header class="ss-hero ss-hero--profile" aria-label="Resumen de cuenta">
      <div class="ss-hero__inner">
        <div class="ss-hero__left">
          <div class="ss-kicker" aria-label="SecciÃ³n">
            <span class="ss-kicker__dot" aria-hidden="true"></span>
            <span>MI CUENTA</span>
          </div>

          <h1 class="ss-title">
            Hola, <span class="ss-title__name">{{ name|e }}</span>
          </h1>

          <p class="ss-subtitle">
            Tu panel premium tipo marketplace: pedidos, puntos, accesos rÃ¡pidos y actividad.
          </p>

          <div class="ss-chiprow" role="list" aria-label="Indicadores rÃ¡pidos">
            <span class="ss-chip" role="listitem">Pedidos: <b>{{ orders }}</b></span>
            <span class="ss-chip" role="listitem">Favoritos: <b>{{ favs }}</b></span>
            <span class="ss-chip" role="listitem">Nivel: <b>Standard</b></span>
            <span class="ss-chip ss-chip--soft" role="listitem">Soporte: <b>24/7</b></span>
          </div>

          <div class="ss-btnrow" role="group" aria-label="Acciones principales">
            <a class="ss-btn ss-btn--primary" href="{{ _shop|e }}" aria-label="Ir a la tienda">ðŸ›’ Ir a la tienda</a>
            <a class="ss-btn ss-btn--soft" href="{{ _featured|e }}" aria-label="Ver destacados">ðŸ”¥ Destacados</a>
            <a class="ss-btn ss-btn--warn" href="{{ _offers|e }}" aria-label="Ver ofertas">âš¡ Ofertas</a>
            <a class="ss-btn ss-btn--ghost" href="{{ _new|e }}" aria-label="Ver novedades">ðŸ†• Novedades</a>
          </div>

          <div class="ss-inline-info" role="list" aria-label="GarantÃ­as rÃ¡pidas">
            <div class="ss-inline-info__item" role="listitem">
              <span class="ss-mini-dot" aria-hidden="true"></span>
              <span>Compras protegidas</span>
            </div>
            <div class="ss-inline-info__item" role="listitem">
              <span class="ss-mini-dot" aria-hidden="true"></span>
              <span>Seguimiento de pedidos</span>
            </div>
            <div class="ss-inline-info__item" role="listitem">
              <span class="ss-mini-dot" aria-hidden="true"></span>
              <span>Pagos seguros</span>
            </div>
          </div>
        </div>

        <aside class="ss-card ss-card--points" aria-label="Puntos Skyline" aria-live="polite">
          <div class="ss-card__head">
            <div class="ss-card__eyebrow">Puntos Skyline</div>
            <div class="ss-points" aria-label="Puntos acumulados">
              <div class="ss-points__value">{{ points }}</div>
              <div class="ss-points__unit">pts</div>
            </div>
          </div>

          <div class="ss-progress" role="progressbar" aria-label="Progreso al prÃ³ximo nivel"
               aria-valuemin="0" aria-valuemax="{{ next_pts }}" aria-valuenow="{{ points }}">
            <div class="ss-progress__bar" style="width: {{ pct }}%"></div>
          </div>

          <div class="ss-card__hint">
            <b>{{ points }}</b> / {{ next_pts }} pts para el prÃ³ximo nivel
          </div>

          <div class="ss-divider" aria-hidden="true"></div>

          <div class="ss-points-actions" role="group" aria-label="Acciones de puntos">
            <a class="ss-mini-btn" href="{{ _shop|e }}">Ganar puntos</a>
            <a class="ss-mini-btn ss-mini-btn--primary" href="{{ _offers|e }}">Canjear ofertas</a>
          </div>
        </aside>
      </div>
    </header>

    <section class="ss-metrics" aria-label="MÃ©tricas" role="list">
      <div class="ss-metric" role="listitem">
        <div class="ss-metric__k">Pedidos</div>
        <div class="ss-metric__v">{{ orders }}</div>
        <div class="ss-metric__d">Compras realizadas</div>
      </div>
      <div class="ss-metric" role="listitem">
        <div class="ss-metric__k">Favoritos</div>
        <div class="ss-metric__v">{{ favs }}</div>
        <div class="ss-metric__d">Guardados</div>
      </div>
      <div class="ss-metric" role="listitem">
        <div class="ss-metric__k">Puntos</div>
        <div class="ss-metric__v">{{ points }}</div>
        <div class="ss-metric__d">Beneficios</div>
      </div>
      <div class="ss-metric" role="listitem">
        <div class="ss-metric__k">Nivel</div>
        <div class="ss-metric__v">Standard</div>
        <div class="ss-metric__d">Perks & accesos</div>
      </div>
    </section>

    <section class="ss-grid2" aria-label="Paneles de actividad">
      <section class="ss-card" aria-label="Acciones rÃ¡pidas">
        <h2 class="ss-card__title">Acciones rÃ¡pidas</h2>
        <p class="ss-card__subtitle">Atajos para moverte como en un marketplace grande</p>

        <div class="ss-list" role="list">
          <a class="ss-row" href="{{ _shop|e }}" role="listitem" aria-label="Comprar ahora">
            <div>
              <div class="ss-row__title">Comprar ahora</div>
              <div class="ss-row__desc">Abrir catÃ¡logo completo</div>
            </div>
            <span class="ss-pill ss-pill--ok" aria-hidden="true">Ir</span>
          </a>

          <a class="ss-row" href="{{ _offers|e }}" role="listitem" aria-label="Ver ofertas">
            <div>
              <div class="ss-row__title">Ofertas</div>
              <div class="ss-row__desc">Promos por tiempo limitado</div>
            </div>
            <span class="ss-pill ss-pill--wait" aria-hidden="true">Ver</span>
          </a>

          <a class="ss-row" href="{{ _featured|e }}" role="listitem" aria-label="Abrir destacados">
            <div>
              <div class="ss-row__title">Destacados</div>
              <div class="ss-row__desc">SelecciÃ³n premium</div>
            </div>
            <span class="ss-pill ss-pill--info" aria-hidden="true">Abrir</span>
          </a>

          <a class="ss-row" href="{{ _new|e }}" role="listitem" aria-label="Abrir novedades">
            <div>
              <div class="ss-row__title">Novedades</div>
              <div class="ss-row__desc">Lo Ãºltimo agregado</div>
            </div>
            <span class="ss-pill ss-pill--info" aria-hidden="true">Nuevo</span>
          </a>
        </div>

        <div class="ss-notice" role="status" aria-live="polite">
          Tip: agregÃ¡ productos a favoritos para verlos acÃ¡ rÃ¡pido.
        </div>
      </section>

      <section class="ss-card" aria-label="Ãšltimos pedidos">
        <h2 class="ss-card__title">Ãšltimos pedidos</h2>
        <p class="ss-card__subtitle">Demo (se reemplaza por tus pedidos reales)</p>

        <div class="ss-list" role="list">
          <div class="ss-row ss-row--static" role="listitem" aria-label="Pedido SKY-1041">
            <div>
              <div class="ss-row__title">SKY-1041</div>
              <div class="ss-row__desc">Seguimiento activo</div>
            </div>
            <span class="ss-pill ss-pill--ok" aria-hidden="true">En camino</span>
          </div>

          <div class="ss-row ss-row--static" role="listitem" aria-label="Pedido SKY-1029">
            <div>
              <div class="ss-row__title">SKY-1029</div>
              <div class="ss-row__desc">Preparando paquete</div>
            </div>
            <span class="ss-pill ss-pill--wait" aria-hidden="true">Procesando</span>
          </div>

          <div class="ss-row ss-row--static" role="listitem" aria-label="Pedido SKY-1014">
            <div>
              <div class="ss-row__title">SKY-1014</div>
              <div class="ss-row__desc">Pedido completado</div>
            </div>
            <span class="ss-pill ss-pill--info" aria-hidden="true">Entregado</span>
          </div>
        </div>

        <div class="ss-notice" role="status" aria-live="polite">
          Modo demo activo. Cuando conectes backend real, esto se llena solo.
        </div>
      </section>
    </section>

    <section class="ss-card ss-card--compact" aria-label="Ayuda y soporte">
      <h2 class="ss-card__title">Â¿NecesitÃ¡s ayuda?</h2>
      <p class="ss-card__subtitle">Soporte rÃ¡pido y polÃ­ticas claras para comprar con confianza.</p>
      <div class="ss-btnrow" role="group" aria-label="Acciones de soporte">
        <a class="ss-btn ss-btn--soft" href="{{ _shop|e }}">Centro de ayuda</a>
        <a class="ss-btn ss-btn--ghost" href="{{ _offers|e }}">Ver promos</a>
      </div>
    </section>

  </section>
</main>
{% endblock %}
